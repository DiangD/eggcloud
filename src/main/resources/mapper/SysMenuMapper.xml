<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.qzh.eggcloud.mapper.SysMenuMapper">
    <resultMap id="SysMenuDetail" type="com.qzh.eggcloud.model.auth.dto.MenuDTO">
        <id property="menuId" column="menu_id"/>
        <result property="parentId" column="parent_id"/>
        <result property="name" column="name"/>
        <result property="permission" column="permission"/>
        <result property="path" column="path"/>
        <result property="component" column="component"/>
        <result property="icon" column="icon"/>
        <result property="weight" column="weight"/>
        <result property="menuType" column="menu_type"/>
        <result property="hide" column="hide"/>
        <result property="createAt" column="create_at"/>
        <result property="updateAt" column="update_at"/>
        <collection property="children" fetchType="eager" ofType="com.qzh.eggcloud.model.auth.dto.MenuDTO"
                    column="menu_id" select="findChildMenusByParentId"/>
    </resultMap>


    <select id="findMenuTreeByRoleIds" resultMap="SysMenuDetail">
        select *
        from sys_menu sm
                     left join sys_role_menu srm on sm.menu_id = srm.menu_id
                where sm.parent_id is null
                  and srm.role_id in
        <foreach collection="roleIds" item="roleId" open="(" separator="," close=")">
            #{roleId}
        </foreach>
    </select>

    <select id="findChildMenusByParentId" resultMap="SysMenuDetail">
        select distinct sm.*
        from sys_menu sm
                     join sys_role_menu srm on sm.menu_id = srm.menu_id
        where parent_id = #{pid}
    </select>

    <select id="findByUserId" resultType="com.qzh.eggcloud.model.auth.SysMenuEntity">
        select distinct sm.*
        from sys_user_role sur
        left join sys_role_menu srm on sur.role_id = srm.role_id
        left join sys_menu sm on srm.menu_id = sm.menu_id
        where sur.user_id = #{userId}
        order by weight desc
    </select>

    <select id="findMenuTreeByUserId" resultMap="SysMenuDetail">
        select distinct sm.*
        from sys_user_role sur
        left join sys_role_menu srm on sur.role_id = srm.role_id
        left join sys_menu sm on srm.menu_id = sm.menu_id
        where sur.user_id = #{userId}
        and sm.parent_id is null
        order by weight desc
    </select>
</mapper>